<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>问卷情况</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" type="text/css" href="css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="css/data.css"/>
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
	</head>
	<body>
		<div class="banner">问卷情况</div>
		<h3 id="title" class="title">关于这个网站的问卷调查</h3>
		<h4 id="ans_number" class="ans_number">共有100人提交了问卷</h4>
		<div class="data_div">
			<ul id="data_ul" class="data_ul">
				<li>
					<p>第1题<span class="que_title">请问你对的看法问你对的看法问你对的看法问你对的看法问你对的看法?</span></p>
					<div class="danxuan_img">
						<span class="danxuan_span1">喜欢</span>
						<span class="danxuan_span2">
							<div class="danxuan_jindu" style="width: 80%;"></div>
						</span>
						<span class="danxuan_span3">80%</span>
					</div>
					<div class="danxuan_img">
						<span class="danxuan_span1">不喜欢不喜欢不喜欢不喜欢</span>
						<span class="danxuan_span2">
							<div class="danxuan_jindu" style="width: 10%;"></div>
						</span>
						<span class="danxuan_span3">9%</span>
					</div>
					<div class="danxuan_img">
						<span class="danxuan_span1">一般般</span>
						<span class="danxuan_span2">
							<div class="danxuan_jindu" style="width: 10%;"></div>
						</span>
						<span class="danxuan_span3">11%</span>
					</div>
				</li>
				
				
				<li>
					<p>第2题<span class="que_title">请问你对的看法问你对的看法问你对的看法问你对的看法问你对的看法?</span></p>
					<div class="duoxuan_img">
						<span class="duoxuan_span1">喜欢</span>
						<span class="duoxuan_span2">80人</span>
					</div>
					<div class="duoxuan_img">
						<span class="duoxuan_span1">不喜欢</span>
						<span class="duoxuan_span2">10人</span>
					</div>
					<div class="duoxuan_img">
						<span class="duoxuan_span1">一般般</span>
						<span class="duoxuan_span2">10人</span>
					</div>
				</li>
				<li>
					<p>第3题<span class="que_title">请问你对的看法问你对的看法问你对的看法问你对的看法问你对的看法?</span></p>
					<div class="wenben_img">
						<pre>监控发哈萨克对方就开始房间拉斯加福克斯就发生发生九分裤</pre>
					</div>
					<div class="wenben_img">
						<pre>监控发哈萨克对方就开始房间拉斯加福克斯就发生发生九分裤发送卡就地方空间按双方就开始 是卡就地方空间按双方就开始 是卡就地方空间按双方就开始 是</pre>
					</div>
					<div class="wenben_img">
						<pre>监控发哈萨克对方就开始房间拉斯加福克斯就发生发生九分裤房卡哈舒服开始就发货上开发还是开发垃圾</pre>
					</div>
				</li>
				<li>
					<p>第4题</p>
					<div></div>
				</li>
			</ul>
		</div>
		<script>
			// 获取问卷的数据
			function getQueryVariable(variable)
			{
				   var query = window.location.search.substring(1);
				   var vars = query.split("&");
				   for (var i=0;i<vars.length;i++) {
						   var pair = vars[i].split("=");
						   if(pair[0] == variable){return pair[1];}
				   }
				   return(false);
			}
			window.onload = function() {
				var queid = getQueryVariable("queid");
				var user = getQueryVariable("user");
				$.ajax(
				{
					url: "./fjson/"+ queid +".json",
					type: "POST",
					datatype: "json",
					success: function (total) {
						// 修改标题和提交人数
						var title = document.getElementById("title");
						var ans_number = document.getElementById("ans_number");
						title.innerHTML = total.title
						var p_number = parseInt(total.number)
						ans_number.innerHTML = "共有"+ p_number +"人提交了问卷";
						// 开始下面的题目
						var data_ul = document.getElementById("data_ul");
						var kuadu = total.data.length;
						var danxuan = [0,0,0,0,0,0,0,0,0,0];
						var danxuan_r = 0;
						for(var i = 0;i<kuadu;i++) {
							if(total.data[i].type == 1) {
								var danxuan_dom = '';
								var danxuan_dom_div = '';
								for(var j = i;j<total.ans.length;j+=kuadu) {
									for(var k = 0;k < total.data[i].ans.length;k++) {
										if(total.data[i].ans[k] == total.ans[j]) {
											danxuan[k]++;
										}
									}
								}
								// 开始创建dom
								for(var o = 0;o < total.data[i].ans.length;o++) {
									console.log(danxuan[o])
									// 设置为保留2位小数
									var danxuan_width = (danxuan[o]/p_number)*100 + "";
									danxuan_width = danxuan_width.substring(0,danxuan_width.indexOf(".") + 3);
									danxuan_dom_div = "<div class='danxuan_img'><span class='danxuan_span1'>"+total.data[i].ans[o]+"</span><span class='danxuan_span2'>"+danxuan[o]+"人<div class='danxuan_jindu' style='width:"+ danxuan_width +"%'></div></span><span class='danxuan_span3'>"+ danxuan_width +"%</span></div>"
									danxuan_dom = danxuan_dom + danxuan_dom_div;
								}
								var danxuan_li = document.createElement("LI");
								danxuan_li.innerHTML = "<p>第"+ parseInt(i+1) +"题<span class='que_title'>"+ total.data[i].que +"</span></p>" + danxuan_dom;
								data_ul.appendChild(danxuan_li);
							}
							else if(total.data[i].type == 2) {
								alert("多选");
							}
							else {
								alert("文本");
							}
						}
					},
					error: function () {
						alert("获取数据失败");
						window.location.href = "uindex.php";
					}
				})
			}
		</script>
	</body>
</html>
